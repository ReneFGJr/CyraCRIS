<div class="container mt-4">
  <h1 class="mb-4">Organizational Units</h1>

  <!-- Altere action conforme sua rota de processamento (POST) -->
  <form method="POST" action="/orgunit/selecionar">
    {# Se usar CSRF (Flask-WTF), inclua: {{ form.csrf_token }} #}

    <input type="hidden" name="ID" value="{{ org_id }}">

    <div class="d-flex align-items-center gap-3 mb-2">
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="checkAll">
        <label class="form-check-label" for="checkAll">Selecionar todos</label>
      </div>
      <button id="submitBtn" type="submit" class="btn btn-primary btn-sm" disabled>
        Processar seleção
      </button>

      Filtro:
      <input type="text" class="form-control form-control-sm" style="width: 400px" value="{{ name }}">
      <button type="button" class="btn btn-secondary btn-sm" onclick="window.location.href='/orgunit/v/{{ org_id }}?q=' + encodeURIComponent(this.previousElementSibling.value);">
        Filtrar
      </button>
    </div>

    <div class="table-responsive">
      <table class="table table-striped table-bordered align-middle">
        <thead class="table-light">
          <tr>
            <th style="width: 40px;"></th>
            <th style="width: 140px;">ID</th>
            <th>Nome</th>
          </tr>
        </thead>
        <tbody>
          {% for row in data %}
          <tr>
            <td class="text-center">
              <!-- name="ids" permite múltiplos valores; value recebe o ID -->
              <input class="form-check-input itemCheck" type="checkbox" name="ids" value="{{ format_id(row[0]) }}">
            </td>
            <td><code>{{ format_id(row[0]) }}</code></td>
            <td>{{ row[2] }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </form>

  <script>
    // Selecionar todos
    const checkAll = document.getElementById('checkAll');
    const itemChecks = () => Array.from(document.querySelectorAll('.itemCheck'));
    const submitBtn = document.getElementById('submitBtn');

    const updateSubmitState = () => {
      const anyChecked = itemChecks().some(ch => ch.checked);
      submitBtn.disabled = !anyChecked;
    };

    checkAll.addEventListener('change', () => {
      itemChecks().forEach(ch => ch.checked = checkAll.checked);
      updateSubmitState();
    });

    itemChecks().forEach(ch => {
      ch.addEventListener('change', () => {
        // Se algum for desmarcado, tira o "selecionar todos"
        if (!ch.checked) checkAll.checked = false;
        // Se todos marcados manualmente, marca "selecionar todos"
        if (itemChecks().every(x => x.checked)) checkAll.checked = true;
        updateSubmitState();
      });
    });

    // Estado inicial
    updateSubmitState();
  </script>
